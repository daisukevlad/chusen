rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    function isAuthenticated() { return request.auth != null; }
    function isAdmin() {
      return isAuthenticated() && request.auth.token.email in ['largeintro@gmail.com'];
    }

    match /campaigns/{campaignId} {
      allow read: if true;
      allow create, delete: if isAdmin();
      
      // 応募者数の更新 (+1) を許可
      allow update: if isAdmin() || (isAuthenticated() && request.resource.data.diff(resource.data).affectedKeys().hasOnly(['entryCount']));

      match /entries/{entryId} {
        // 自分のIDの名前のデータなら読み書き自由（他人のデータは見れない）
        allow read, write: if isAdmin() || (isAuthenticated() && entryId == request.auth.uid);
      }
    }
  }
}
